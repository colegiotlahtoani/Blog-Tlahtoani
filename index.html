// Blog académico del Colegio Tlahtoani
import { useState, useEffect } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Textarea } from "@/components/ui/textarea";
import { Tabs, TabsList, TabsTrigger } from "@/components/ui/tabs";

const COLORS = {
  primary: "#004080",
  accent: "#FF6A00"
};

const mockInvestigaciones = [
  { id: 1, titulo: "La biodiversidad en México", autor: "Ana López", resumen: "Exploración de ecosistemas mexicanos...", contenido: "Texto completo de la investigación sobre biodiversidad..." },
  { id: 2, titulo: "Matemáticas en la vida cotidiana", autor: "Carlos Pérez", resumen: "Ejemplos del uso diario de las matemáticas...", contenido: "Texto completo de la investigación sobre matemáticas..." }
];

export default function BlogTlahtoani() {
  const [vista, setVista] = useState("investigaciones");
  const [investigaciones, setInvestigaciones] = useState(mockInvestigaciones);
  const [seleccionada, setSeleccionada] = useState(null);
  const [usuario, setUsuario] = useState(null);
  const [credenciales, setCredenciales] = useState({ email: "", password: "" });
  const [nueva, setNueva] = useState({ titulo: "", autor: "", resumen: "", contenido: "" });

  const login = () => {
    if (credenciales.email === "juanpahdezreyes11@gmail.com" && credenciales.password === "Cdmv6058Pd2kb3a$") {
      setUsuario(credenciales.email);
      setVista("investigaciones");
    } else {
      alert("Credenciales incorrectas");
    }
  };

  const logout = () => {
    setUsuario(null);
    setCredenciales({ email: "", password: "" });
  };

  const agregarInvestigacion = () => {
    const nuevaInv = { ...nueva, id: Date.now() };
    setInvestigaciones([...investigaciones, nuevaInv]);
    setNueva({ titulo: "", autor: "", resumen: "", contenido: "" });
  };

  const eliminarInvestigacion = (id) => {
    if (confirm("¿Estás seguro de eliminar esta investigación?")) {
      setInvestigaciones(investigaciones.filter(inv => inv.id !== id));
      setSeleccionada(null);
    }
  };

  const autoresUnicos = [...new Set(investigaciones.map(inv => inv.autor))];
  const [autorFiltro, setAutorFiltro] = useState("");

  const investigacionesFiltradas = autorFiltro
    ? investigaciones.filter(inv => inv.autor === autorFiltro)
    : investigaciones;

  return (
    <div className="min-h-screen p-4" style={{ backgroundColor: "#f0f4ff", color: COLORS.primary }}>
      <header className="flex flex-col sm:flex-row justify-between items-center mb-4">
        <h1 className="text-3xl font-bold">Colegio Tlahtoani - Investigaciones</h1>
        <TabsList>
          <TabsTrigger onClick={() => setVista("investigaciones")}>Investigaciones</TabsTrigger>
          <TabsTrigger onClick={() => setVista("autores")}>Autores</TabsTrigger>
          <TabsTrigger onClick={() => setVista("acerca")}>Acerca de</TabsTrigger>
          {usuario ? (
            <TabsTrigger onClick={logout} style={{ color: COLORS.accent }}>Cerrar sesión</TabsTrigger>
          ) : (
            <TabsTrigger onClick={() => setVista("login")} style={{ color: COLORS.accent }}>Iniciar sesión</TabsTrigger>
          )}
        </TabsList>
      </header>

      {vista === "investigaciones" && (
        <div>
          <p className="mb-4">Bienvenidos al blog académico del Colegio Tlahtoani. Aquí encontrarán investigaciones realizadas por nuestros estudiantes.</p>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {investigaciones.map(inv => (
              <Card key={inv.id}>
                <CardContent>
                  <h2 className="text-xl font-semibold">{inv.titulo}</h2>
                  <p className="text-sm italic">por {inv.autor}</p>
                  <p className="my-2">{inv.resumen}</p>
                  <Button onClick={() => setSeleccionada(inv)}>Leer más</Button>
                  {usuario && <Button onClick={() => eliminarInvestigacion(inv.id)} className="ml-2" variant="destructive">Eliminar</Button>}
                </CardContent>
              </Card>
            ))}
          </div>
          {usuario && (
            <div className="mt-8 p-4 border rounded-lg bg-white">
              <h2 className="text-xl font-semibold mb-2">Nueva investigación</h2>
              <Input placeholder="Título" value={nueva.titulo} onChange={e => setNueva({ ...nueva, titulo: e.target.value })} className="mb-2" />
              <Input placeholder="Autor" value={nueva.autor} onChange={e => setNueva({ ...nueva, autor: e.target.value })} className="mb-2" />
              <Textarea placeholder="Resumen" value={nueva.resumen} onChange={e => setNueva({ ...nueva, resumen: e.target.value })} className="mb-2" />
              <Textarea placeholder="Contenido completo" value={nueva.contenido} onChange={e => setNueva({ ...nueva, contenido: e.target.value })} className="mb-2" />
              <Button onClick={agregarInvestigacion} style={{ backgroundColor: COLORS.accent, color: "white" }}>Subir investigación</Button>
            </div>
          )}
          {seleccionada && (
            <div className="fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex justify-center items-center z-50">
              <div className="bg-white p-6 rounded-lg max-w-lg w-full">
                <h2 className="text-2xl font-bold mb-2">{seleccionada.titulo}</h2>
                <p className="italic mb-4">por {seleccionada.autor}</p>
                <p>{seleccionada.contenido}</p>
                <Button onClick={() => setSeleccionada(null)} className="mt-4">Cerrar</Button>
              </div>
            </div>
          )}
        </div>
      )}

      {vista === "autores" && (
        <div>
          <h2 className="text-xl font-semibold mb-4">Filtrar por autor</h2>
          <select className="mb-4" value={autorFiltro} onChange={e => setAutorFiltro(e.target.value)}>
            <option value="">Todos</option>
            {autoresUnicos.map(autor => <option key={autor}>{autor}</option>)}
          </select>
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
            {investigacionesFiltradas.map(inv => (
              <Card key={inv.id}>
                <CardContent>
                  <h2 className="text-xl font-semibold">{inv.titulo}</h2>
                  <p className="text-sm italic">por {inv.autor}</p>
                  <p className="my-2">{inv.resumen}</p>
                  <Button onClick={() => setSeleccionada(inv)}>Leer más</Button>
                </CardContent>
              </Card>
            ))}
          </div>
        </div>
      )}

      {vista === "acerca" && (
        <div>
          <h2 className="text-xl font-bold mb-4">Acerca del blog</h2>
          <p>Este espacio ha sido creado para fomentar la investigación y difusión del conocimiento entre los estudiantes del Colegio Tlahtoani.</p>
        </div>
      )}

      {vista === "login" && (
        <div className="max-w-md mx-auto">
          <h2 className="text-xl font-bold mb-4">Iniciar sesión</h2>
          <Input placeholder="Correo electrónico" value={credenciales.email} onChange={e => setCredenciales({ ...credenciales, email: e.target.value })} className="mb-2" />
          <Input type="password" placeholder="Contraseña" value={credenciales.password} onChange={e => setCredenciales({ ...credenciales, password: e.target.value })} className="mb-2" />
          <Button onClick={login} style={{ backgroundColor: COLORS.primary, color: "white" }}>Entrar</Button>
        </div>
      )}
    </div>
  );
}
